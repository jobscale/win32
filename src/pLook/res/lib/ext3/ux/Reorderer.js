/*
 * Ext JS Library 3.2.1
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.Reorderer=Ext.extend(Object,{defaults:{animate:true,animationDuration:0.2,defaultReorderable:false},constructor:function(a){Ext.apply(this,a||{},this.defaults)},init:function(c){this.target=c;this.initEvents();var a=this.getItems();for(var b=0;b<a.length;b++){this.createIfReorderable(a[b])}},reorder:function(b){var a=this.target;if(a.fireEvent("before-reorder",b,a,this)!==false){this.doReorder(b);a.fireEvent("reorder",b,a,this)}},doReorder:function(a){throw new Error("doReorder must be implemented in the Ext.ux.Reorderer subclass")},createItemDD:function(a){throw new Error("createItemDD must be implemented in the Ext.ux.Reorderer subclass")},createItemDD:function(a){var b=a.getEl(),e=b.id,d=this.target,c=this;a.dd=new Ext.dd.DD(b,undefined,{isTarget:false});a.dd.constrainTo(d.getEl());a.dd.setYConstraint(0,0,0);Ext.apply(a.dd,{b4StartDrag:function(){this.startPosition=b.getXY();this.startZIndex=b.getStyle("zIndex");b.setStyle("zIndex",10000);a.suspendEvents()},onDrag:function(j){var o=b.getXY()[0],g=o-this.startPosition[0],k=d.items.items,m=k.indexOf(a),n;for(var i=0;i<k.length;i++){var q=k[i];if(q.reorderable&&q.id!=a.id){var h=q.getEl().getBox(),p=(c.buttonXCache[q.id]||h.x)+(h.width/2),f=m>i&&g<0&&o<p,l=m<i&&g>0&&(o+b.getWidth())>p;if(f||l){c[f?"onMovedLeft":"onMovedRight"](a,i,m);break}}}},endDrag:function(){c.updateButtonXCache();b.moveTo(c.buttonXCache[a.id],undefined,{duration:c.animationDuration,scope:this,callback:function(){a.resumeEvents();d.fireEvent("reordered",a,d)}});b.setStyle("zIndex",this.startZIndex)}})},createIfReorderable:function(a){if(this.defaultReorderable&&a.reorderable==undefined){a.reorderable=true}if(a.reorderable){if(a.rendered){this.createItemDD(a)}else{a.on("render",this.createItemDD.createDelegate(this,[a]),this,{single:true})}}},getItems:function(){return this.target.items.items},initEvents:function(){this.target.addEvents("before-reorder","reorder")}});