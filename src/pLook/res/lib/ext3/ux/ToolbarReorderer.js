/*
 * Ext JS Library 3.2.1
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.ToolbarReorderer=Ext.extend(Ext.ux.Reorderer,{init:function(a){this.buttonXCache={};a.on({scope:this,add:function(c,b){this.createIfReorderable(b)}});Ext.ux.ToolbarReorderer.superclass.init.apply(this,arguments)},createItemDD:function(a){if(a.dd!=undefined){return}var c=a.getEl(),f=c.id,e=this.target,d=this;a.dd=new Ext.dd.DD(c,undefined,{isTarget:false});var b=function(){return false};Ext.apply(a.dd,{b4StartDrag:function(){this.startPosition=c.getXY();this.startZIndex=c.getStyle("zIndex");c.setStyle("zIndex",10000);a.suspendEvents();if(a.menu){a.menu.on("beforeshow",b,d)}},startDrag:function(){this.constrainTo(e.getEl());this.setYConstraint(0,0,0)},onDrag:function(k){var p=c.getXY()[0],h=p-this.startPosition[0],l=e.items.items,n=l.indexOf(a),o;for(var j=0;j<l.length;j++){var r=l[j];if(r.reorderable&&r.id!=a.id){var i=r.getEl().getBox(),q=(d.buttonXCache[r.id]||i.x)+(i.width/2),g=n>j&&h<0&&p<q,m=n<j&&h>0&&(p+c.getWidth())>q;if(g||m){d[g?"onMovedLeft":"onMovedRight"](a,j,n);break}}}},endDrag:function(){d.updateButtonXCache();c.moveTo(d.buttonXCache[a.id],c.getY(),{duration:d.animationDuration,scope:this,callback:function(){a.resumeEvents();if(a.menu){a.menu.un("beforeshow",b,d)}e.fireEvent("reordered",a,e)}});c.setStyle("zIndex",this.startZIndex)}})},onMovedLeft:function(i,h,g){var c=this.target,f=c.items.items;if(h!=undefined&&h!=g){c.remove(i,false);c.insert(h,i);this.updateButtonXCache();for(var e=0;e<f.length;e++){var d=f[e],a=this.buttonXCache[d.id];if(i==d){i.dd.startPosition[0]=a}else{var b=d.getEl();b.moveTo(a,b.getY(),{duration:this.animationDuration})}}}},onMovedRight:function(b,a,c){this.onMovedLeft.apply(this,arguments)},updateButtonXCache:function(){var c=this.target,a=c.items,b=c.getEl().getBox(true).x;a.each(function(d){this.buttonXCache[d.id]=b;b+=d.getEl().getWidth()},this)}});